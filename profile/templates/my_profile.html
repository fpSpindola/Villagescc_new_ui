{% extends "base.html" %}

{% block title %}{{ profile }}{% endblock %}

{% block nav_info_class %}selected{% endblock %}

{% block content %}
{% load profile relate humanize feed%}
{% load staticfiles %}
{% load i18n %}

<style>
    .image {
    width: 60px;
    height: 60px;
    float: left;
    border: 1px hidden #999;
}
.thumbnail{
    width : 270px;
    height: 250px;
    overflow: auto;
}

.thumbnail .listing {
    width: 100%;
    height: 150px;
    display: block;
}
</style>

<div class="container-fluid" id="profile-container-fluid">
  <div class="jumbotron" id="profile-jumbotron">
    <h2>{{ profile.name }}</h2>
  </div>
</div>

    <section class="container-fluid" id="profile-info">
        <div class="row">
            <div class="col-md-8">
                <div class="inside-profile-info">
                    <p>Profile description:</p>
                    <p>{{ profile.description }}</p>
                </div>
                <hr>
            </div>

            <div class="col-md-4" style="text-align: center;">
                <img src="{% profile_image_url request.profile '150x150' %}" alt="" height=88px width=88px class="img-circle">
                <p class="profile-star-rating">
                <th>{% trans 'Reputation: ' %}</th>
                <td>{% reputation profile request.profile %}</td>
                </p>
                <p><i class="fa fa-balance-scale" aria-hidden="true"></i>
                {% blocktrans count hours=profile.overall_balance %} - {{ hours }} hour
                {% plural %} {{ hours }} hours</p>{% endblocktrans %}

                <p><i class="fa fa-pencil" aria-hidden="true"></i>Job: {% if profile.job %}{{ profile.job }} {% else %} -- {% endif %}</p>
                <p><i class="fa fa-heart" aria-hidden="true"></i> Total Hearts: {{ profile.endorsement_sum }}</p>
                <p data-toggle="tooltip" title="{{ profile.location.full_name }}"><i class="fa fa-home" aria-hidden="true" data-toggle="tooltip" title="{{ profile.location.full_name }}"></i>{{ profile.location.full_name|slice:":50" }}</p>
                <p><i class="fa fa-calendar" aria-hidden="true"></i> {{ profile.user.date_joined|naturalday }}</p>
            </div>

        </div>
    </section>

<section class="container-fluid" id="profile-listing-info">
  <div class="row">
    <div class="col-md-9">
    {% if listings %}
      <h3>Open listings</h3>
      <bold><hr></bold>
        <!-- Construct in the for loop -->
        {% for each in listings %}
          <div class="col-sm-6 col-md-4">
                    <div class="thumbnail">
                        <img class="listing listing-modal-profile" src="{% product_image_url each '280x280' %}" alt="..." data-listing-id="{{ each.id }}">
                        <p class="thumbnail-tag" style="margin-left: -55px;">{{ each.subcategories.sub_categories_text }}</p>
                        <p class="thumbnail-info"></p>
                        <div class="caption" style="height: 60px;">
                            <a href="{{ each.user.profile.get_absolute_url }}" style="float: left;"><img src="{% profile_image_url each.user.profile '60x60' %}" class="img-circle inline"/></a>
                            <p>&nbsp{{ each.title }}</p>
                        </div>
                    </div>
                </div>
        {% endfor %}
            {% else %}
            <h3>There is no open listings for this user</h3>
    {% endif %}
    </div>
  <div class="col-md-3">
{#  <p><i class="fa fa-balance-scale" aria-hidden="true"></i>{% blocktrans count hours=profile.overall_balance %} - {{ hours }} hour {% plural %} {{ hours }} hours</p>#}
{#    {% endblocktrans %}#}


  <div class="card">
    <h4>Offerings</h4>
    <span class="badge">Massage</span>
    <span class="badge">Web Design</span>
    <span class="badge">Child Care</span>
    <span class="badge">Off Grid</span>
  </div>
  <div class="card">
    <h4>Requests</h4>
    <span class="badge">Massage</span>
    <span class="badge">Organic Vegan Food</span>
    <span class="badge">Help Building</span>
    <span class="badge">Kids Stuff</span>
  </div>
</div>
</div>

</section>

<section class="container-fluid">
  <div class="row">
  <div class="col-md-9">
      <h3>Endorsed by:</h3>
    {% if endorsements_received %}
      {% for each_endorsement_received in endorsements_received %}
          <div class="container-fluid">
          <hr>
          <div class="image">
            <img class="img-rounded endorsed-by-img" src="{% profile_image_url each_endorsement_received.endorser '60x60' %}" alt="">
          </div>
            <p class="text">Description: {{ each_endorsement_received.text }}</p>
            <p class="text">From <a href="{{ each_endorsement_received.get_absolute_url }}">{{ each_endorsement_received.endorser.name }}</a> to <a href="{{ each_endorsement_received.get_absolute_url }}">{{ profile.name }}</a></p>
          </div>
      {% endfor %}
    {% else %}
        <p class="text">No endorsements received yet</p>
    {% endif %}
    </div>
  </div>
</section>


<section class="container-fluid">
  <div class="row">
  <div class="col-md-9">
      <h3>Endorsed by:</h3>
    {% if endorsements_made %}
      {% for each_endorsement_made in endorsements_made %}
          <div class="container-fluid">
          <hr>
          <div class="image">
            <img class="img-rounded endorsed-by-img" src="{% profile_image_url each_endorsement_made.endorser '60x60' %}" alt="">
          </div>
            <p class="text">Description: {{ each_endorsement_made.text }}</p>
            <p class="text">From <a href="{{ each_endorsement_made.get_absolute_url }}">{{ each_endorsement_made.endorser.name }}</a> to <a href="{{ each_endorsement_made.get_absolute_url }}">{{ profile.name }}</a></p>
          </div>
      {% endfor %}
    {% else %}
        <p class="text">No endorsements received yet</p>
    {% endif %}
    </div>
  </div>
</section>
{% endblock %}

<script>
    $(".listing-modal-profile").click(function (e) {
            $('#spin-modal').fadeIn();
            debugger;
            var listing_id = $(this).attr('data-listing-id');
            var url = '/get_listing_info/'+listing_id;
            var listing_picture_path = '/media/';
            $.ajax({
                url: url,
                type: 'GET',
                cache: false,
                success: function (data) {
                    if(data["data"]["stat"] == "ok"){
                        debugger;
                        $('#listing-id').val(listing_id);
                        $('.listing-modal-title').text(data["data"]["listing_title"]);
                        $('.listing-img').attr("src", listing_picture_path+data["data"]["listing_photo"]);
                        $('#label-price').text(data["data"]["listing_price"]);
                        $('#label-profile-name').text(data["data"]["profile_name"]);
                        $('#profile-location').text(data["data"]["profile_location"]);
                        $('#listing-created-at').text(data["data"]["created_at"]);
                        $('#listing-created-at').attr("href", "/listing_details/"+listing_id);
                        $('#label-description').text(data["data"]["description"]);
                        $('#label-profile-username').text(data["data"]["username"]);
                        $('#label-profile-balance').text(data["data"]["balance"]);
                        $('#label-profile-occupation').text(data["data"]["job"]);
                        debugger;
    {#                    $('#trust-btn').find() = data["data"]["username"];#}
    {#                    $('#payment-btn').data('data-profile-username', data["data"]["username"]);#}
    {#                    $('#contact-btn').data('data-profile-username', data["data"]["username"]);#}
                        $('#spin-modal').fadeOut();
                        $("#listing-modal").modal("show");
                    }
                },
                error: function (data) {
                    $('#spin-modal').fadeOut();
                    showInternalServerError();
                }
            });
        });
</script>
