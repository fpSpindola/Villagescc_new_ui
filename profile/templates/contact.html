{% extends "profile_base.html" %}
{% load i18n %}

{% block title %}
    {% blocktrans %}Contact {{ profile }}{% endblocktrans %}
{% endblock %}

{% block content %}

    <link rel="stylesheet" href="http://code.jquery.com/ui/1.8.18/themes/base/jquery-ui.css" type="text/css" media="all" />
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript">
    </script> <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js" type="text/javascript"></script>

    <form id="blank-contact-form" action="" method="post">
        {% csrf_token %}
        <div class="container">
            <h2>{% blocktrans %}Contact {{ profile }}{% endblocktrans %}</h2>
            <p class="feature">
                {% blocktrans %}Your message will be forwarded
                    to {{ profile }} by email.{% endblocktrans %}</p>
            {% for field in form %}
                {% if field.errors %}
                    <div class="form-group">
                        <label for="{{ field.label }}" class="error">{{ field.label }}</label>
                        {{ field }}
                        <div class="alert alert-warning message">
                            {% for error in field.errors %}
                                {{ error }}
                            {% endfor %}
                        </div>
                    </div>
                {% else %}
                    <div class="form-group">
                        <label for="{{ field.label }}">{{ field.label }}</label>
                        {{ field }}
                    </div>
                {% endif %}
            {% endfor %}

            <input id="selected-contact-recipient-value" hidden>

            <tr>
                <td><input type="submit" class="btn btn-primary" value="{% trans 'Send' %}"></td>
            </tr>
        </div>
    </form>

    <script>
        $(function() {
            $("#id_contact_recipient_name").autocomplete({
                source: "/get_profiles",
                minLength: 2,
                select: function (event, ui) {
                    console.log(ui.item.id);
                    $("#selected-contact-recipient-value").val(ui.item.id);
                    $("#id_contact_recipient_name").val(ui.item.id);
{#                    $("#id_contact_recipient_name").text(ui.item.label);#}
                    $("#id_contact_recipient_name").attr("data-profile-selected", ui.item.id);
                    var profile = $('#id_contact_recipient_name').attr("data-profile-selected");
{#                    var url = '/relate/get_user_photo/' + profile;#}
                }
            })
        });

        $("#blank-contact-form").submit(function (e) {
            $("#id_contact_recipient_name").val($("#selected-contact-recipient-value").val());
        })
    </script>

{% endblock %}
