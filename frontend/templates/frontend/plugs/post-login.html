{% load staticfiles profile i18n %}

<style>
.html {
    padding-left: 15px;
    padding-right: 15px;
}

h1 { color: #ff4411; font-size: 20px; font-family: 'Signika', sans-serif; padding-bottom: 10px; }
p { font-family: 'Inder', sans-serif; line-height: 28px; margin-bottom: 15px; color: #666; }
a { color: #ff4411; transition: .5s; -moz-transition: .5s; -webkit-transition: .5s; -o-transition: .5s; }
a:hover { color: #a03c21 }

.meta-info p { font-family: 'Fenix', serif; font-style: italic; color: #666; font-size: 16px; }

.thumbnail{
    width : 300px;
    height: 260px;
    overflow: auto;
}

.thumbnail .listing {
    width: 100%;
    height: 150px;
    display: block;
}
</style>

<div style="height: 100px;"></div>

<section class="container-fluid" id="home-sub-menu">
    <div class="row">
        <div class="col-md-2">
            <p><a href="{% url 'frontend:home' %}">ALL CATEGORIES</a></p>
            <nav class="sidebar">
                <ul class="nav sidenav">
                    {% for each in categories %}
                        {% if each.categories_text == 'PRODUCTS' %}
                            <li><a href="{% url 'frontend:category_type' 'PRODUCTS' %}">{{ each.categories_text }}</a>
                                <ul class="nav">
                                    {% for each_sub_category in item_sub_categories %}
                                        <li><a href="{% url 'frontend:home' each_sub_category.sub_categories_text %}">{{ each_sub_category.sub_categories_text }}</a></li>
                                    {% endfor %}
                                </ul>
                            </li>
                        {% elif each.categories_text == 'SERVICES' %}
                            <li><a href="{% url 'frontend:category_type' 'SERVICES' %}">{{ each.categories_text }}</a>
                                <ul class="nav">
                                    {% for each_sub_category in services_sub_categories %}
                                        <li><a href="#"></a></li>
                                    {% endfor %}
                                </ul>
                            </li>
                        {% elif each.categories_text == 'RIDESHARE' %}
                            <li><a href="{% url 'frontend:category_type' 'RIDESHARE' %}">{{ each.categories_text }}</a>
                                <ul class="nav">
                                    {% for each_sub_category in rideshare_sub_categories %}
                                        <li><a href="#">{{ each_sub_category.sub_categories_text }}</a></li>
                                    {% endfor %}
                                </ul>
                            </li>
                        {% elif each.categories_text == 'HOUSING' %}
                            <li><a href="{% url 'frontend:category_type' 'HOUSING' %}">{{ each.categories_text }}</a>
                                <ul class="nav">
                                    {% for each_sub_category in housing_sub_categories %}
                                        <li><a href="#">{{ each_sub_category.sub_categories_text }}</a></li>
                                    {% endfor %}
                                </ul>
                            </li>
                        {% endif %}
                    {% endfor %}
                </ul>
            </nav>
            <br>
        </div>
        <div class="col-md-6">
            <div class="">
                <form class="inline_form nav" action="" method="get"><ul>
                    <div class="btn-group">
                        {% if listings %}
                        <button type="button" class="btn btn-default btn-md btn-change" style="float: left;">All listing types</button>
                        <button type="button" class="btn btn-default btn-md dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="padding-left: 5px;">
                            <span class="caret"></span>
                        </button>
                        <!-- Given for loop to construct all -->
                        <ul class="dropdown-menu">
                            <li><a href="{% url 'frontend:listing_type' 'OF' %}">Offer</a></li>
                            <li><a href="{% url 'frontend:listing_type' 'RQ' %}">Request</a></li>
                            <li><a href="{% url 'frontend:listing_type' 'TC' %}">Teach</a></li>
                            <li role="separator" class="divider"></li>
                            <li><a href="{% url 'frontend:listing_type' 'LR' %}">Learn</a></li>
                            <li><a href="{% url 'frontend:listing_type' 'GT' %}">Gift</a></li>
                        </ul>
                    </div>
                {% endif %}
                {% if not listings %}
                    <div class="input-group" style="align-content: center; width: 250%;">
                        {{ form.q }}
                    </div>
                    <span>{{ form.radius }}</span>
                        <span><label>{{ form.trusted }}
                            <img src="{% static 'img/heart_icon.png' %}"
                                 alt="{% trans 'Heart icon = trusted user' %}">
                            {% trans 'Trusted only' %}</label></span>
                {% endif %}
                        <span style="padding-left: 5%; width: 22px;">
                            <a href="{% url 'frontend:home_people' %}"><img src="{% static 'img/people.png' %}" height="22" width="22">&nbsp People only</a>
                        </span>

                </ul></form>
            </div>

{#            <span class="{% block feed_people_class %}{% endblock %}" style="padding-left: 5%;"><a href="{% url 'frontend:home' %}?{{ url_param_str }}"><img src="{% static 'img/heart_icon.png' %}" height="22" width="22">&nbsp Trusted only</a></span>#}
{#            <span class="distance-range" style="padding-left: 5%;" data-toggle="tooltip" title="Distance from you (in miles)">#}
{#            <input#}
{#                    id="ex2"#}
{#                    type="text"#}
{#                    class="span2"#}
{#                    value=""#}
{#                    data-slider-min="1000"#}
{#                    data-slider-max="50000"#}
{#                    data-slider-step="4"#}
{#                    data-slider-value="[1000,5000]"#}
{#                    data-slider-handle="square"/>#}
{#            <button type="button" class="btn btn-warning" name="button" style="float: right;">update distance</button>#}
{#            </span>#}
        </div>

        <div class="col-md-3" style="float: right;">
            <button type="button" class="btn btn-default btn-md btn-last btn-non-active pull-right">
                <span class="glyphicon glyphicon-map-marker" aria-hidden="true"></span> Map
            </button>
            <button type="button" class="btn btn-default btn-md btn-second btn-non-active pull-right">
                <span class="glyphicon glyphicon-th-list" aria-hidden="true"></span> List
            </button>
            <button type="button" class="btn btn-default btn-md btn-first btn-active pull-right">
                <span class="glyphicon glyphicon-th" aria-hidden="true"></span> Grid
            </button>
        </div>

      <div style="height: 80px;"></div>

        <hr>

        {% if feed_items %}
        <div class="col-md-9">
            <div class="feed_item_list">
            {% for each in feed_items %}
                <div class="panel panel-default line{% if each.trusted %} trusted{% else %} untrusted{% endif %}">
                    <div class="panel-heading">{{ each }}</div>
                        <div class="panel-body">
                            <a href="{{ each.get_absolute_url }}">
                                <img src="{% profile_image_url each '100x100' %}" style="height: 70px; width: 100px;">
                            </a>
                            <span><i class="fa fa-location-arrow" style="font-size: medium">&nbsp{{ each.location }}</i></span>
                            <p style="margin-left: 15px;"><i class="fa fa-balance-scale"></i>&nbsp{{ each.overall_balance }} hours</p>

                        </div>
                    <div class="btn-group btn-group-md" role="group" style="float: left; margin-left: 10px; margin-bottom: 2px;">
                        <button type="button" class="btn btn-default btn-danger" data-toggle="tooltip" title="Endorse this person">
                            <i class="fa fa-heart" aria-hidden="true"></i>
                        </button>
                        <button type="button" class="btn btn-default btn-success" data-toggle="tooltip" title="Make payment">
                            <i class="fa fa-money" aria-hidden="true"></i>
                        </button>
                        <button type="button" class="btn btn-default btn-primary" data-toggle="tooltip" title="Contact this person">
                            <i class="fa fa-envelope" aria-hidden="true"></i>
                        </button>
                    </div>
                </div>
                {% empty %}
                <p><em>{{ empty_string|default:_('No activity.') }}</em></p>
            {% endfor %}
            </div>

        {% elif listings %}
        <div class="col-md-9">
            {% for each in listings %}
                <div id="div_listing_{{ each.user.profile.username }}" class="col-sm-6 col-md-4">
                    <div class="thumbnail">
                        <img class="listing" src="{% product_image_url each '280x280' %}" alt="...">
                        <p class="thumbnail-tag" style="margin-left: -55px;">{{ each.subcategories.sub_categories_text }}</p>
                        <p class="thumbnail-info"></p>
                        <div class="caption" style="height: 60px;">
                            <a href="{{ each.user.profile.get_absolute_url }}" style="float: left;"><img src="{% profile_image_url each.user.profile '60x60' %}" class="img-circle inline"/></a>
                            <p>&nbsp;{{ each.title }}</p>
                            <div class="btn-group btn-group-lg btn-top-adjust" role="group" aria-label="..." style="float: right;">
                                <button id="" type="button" class="btn btn-default btn-danger trust-modal" title="Trust this person" data-profile-username="{{ each.user.profile.username }}">
                                    <i class="fa fa-heart" aria-hidden="true"></i>
                                </button>
                                <button type="button" class="btn btn-default btn-success" data-toggle="modal" data-target="#new-payment-modal" title="Check your payments" data-profile-username="{{ each.user.profile.username }}">
                                    <i class="fa fa-money" aria-hidden="true"></i>
                                </button>
                                <button id="contact-modal-submit" type="button" class="btn btn-default btn-primary" data-toggle="modal" data-target="#contact-modal" data-profile-username="{{ each.user.profile.username }}">
                                    <i class="fa fa-envelope" aria-hidden="true"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div class="col-md-9">
                <strong>There is nothing to show</strong>
            </div>
        {% endif %}
        </div>
</div>
{% if remaining_count %}
	<p><a href="?{{ next_page_param_str }}">
		{% blocktrans %}{{ remaining_count }} More &raquo;{% endblocktrans %}
	</a></p>
{% endif %}
    </div>
</section>

<!-- Trust Modal -->
<form class="form-horizontal" id="new-trust-form" method="POST">
    {% csrf_token %}
    <div id="new-trust-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <input type="text" id="profile-username" hidden>
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;  </button>
                    <h4 class="modal-title" id="myModalLabel">Trust this person</h4>
                </div>
                <div id="modaltext" class="modal-body">
                    <div class="form-group">
                        <div class="container-fluid">
                            <label for="{{ trust_form.weight.label }}" class="control-label {% if field.errors %}error{% endif %}">{{ trust_form.weight.label }}</label>
                            <div class="input-group">
                                {{ trust_form.weight }}
                            </div>
                            <label for="{{ trust_form.text.label }}" class="control-label {% if field.errors %}error{% endif %}">{{ trust_form.text.label }}</label>
                            <div class="input-group">
                                {{ trust_form.text}}
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" id="save-trust" class=" btn btn-success gradient save-button">
                            <i class="fa fa-check"></i>Save Trust
                        </button>
                        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                    </div>
                    <div id="msg"></div>
                </div>
            </div>
        </div>
    </div>
</form>

<script>
    $("#save-trust").click(function(e) {
        var profile_username = $("#profile-username").val();
        var url = 'relate/endorse/'+profile_username+'/';
        console.log(url);
        $.ajax({
            url: url,
            type: 'POST',
            data: {
                'profile_username': profile_username
            },
            beforeSend: function (xhr) {
                var csrftoken = $(document).find("input[name='csrfmiddlewaretoken']").val();
                xhr.setRequestHeader("X-CSRFToken", csrftoken);
            },
            success: function(resp){
                console.log('Sucesso!');
                alert('Success!');
                $('#msg').html(resp).fadeIn('slow');
                $('#msg').html("Target inserted successfully").fadeIn('slow');
                $('#msg').delay(2500).fadeOut('slow');
            },
            error: function (resp){
                console.log(resp);
            }
        });
        e.preventDefault();
    });
</script>

{#{% include  'new_trust_modal.html' %}#}
{% include 'new_payment_modal.html' %}
{% include 'new_contact_modal.html' %}

<script>
    $(".trust-modal").click(function (e) {
        var profile_username = $(this).attr('data-profile-username');
        $("#new-trust-modal").modal("show");
        console.log(profile_username);
        $("#profile-username").val(profile_username)
    });
</script>

